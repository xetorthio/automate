{
 "AWSTemplateFormatVersion" : "2010-09-09",

 "Description" : "This is a test",

 "Parameters" : {
   "WebServerPort" : {
     "Description" : "TCP/IP port of the web server",
     "Type" : "String",
     "Default" : "8888"
   },

   "KeyName" : {
     "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instance",
     "Type" : "String"
   }
 },

 "Resources" : {
   "Ec2Instance" : {
     "Type" : "AWS::EC2::Instance",
     "Properties" : {
       "SecurityGroups" : [ { "Ref" : "InstanceSecurityGroup" } ],
       "KeyName" : { "Ref" : "KeyName" },
       "ImageId" : "ami-7a11e213",
       "InstanceType" : "t1.micro",
       "UserData" : { "Fn::Base64" : { "Ref" : "WebServerPort" }}
     }
   },

   "InstanceSecurityGroup" : {
     "Type" : "AWS::EC2::SecurityGroup",
     "Properties" : {
       "GroupDescription" : "Enable SSH access and HTTP access on the inbound port",
       "SecurityGroupIngress" : [ {
         "IpProtocol" : "tcp",
         "FromPort" : "22",
         "ToPort" : "22",
         "CidrIp" : "0.0.0.0/0"
       },
       {
         "IpProtocol" : "tcp",
         "FromPort" : { "Ref" : "WebServerPort" },
         "ToPort" : { "Ref" : "WebServerPort" },
         "CidrIp" : "0.0.0.0/0"
       } ]
     }
   },

   "EIP" : {
     "Type" : "AWS::EC2::EIP",
     "Properties" : {
       "InstanceId" : { "Ref" : "Ec2Instance" }
     }
   }
 },

 "Outputs" : {

   "InstanceId" : {
     "Description" : "InstanceId of the newly created EC2 instance",
     "Value" : { "Ref" : "Ec2Instance" }
   },

   "AZ" : {
     "Description" : "Availability Zone of the newly created EC2 instance",
     "Value" : { "Fn::GetAtt" : [ "Ec2Instance", "AvailabilityZone" ] }
   },

   "URL" : {
     "Description" : "URL of the sample website",
     "Value" : { "Fn::Join" : [ "", [ "http://", { "Ref" : "EIP" }, ":", { "Ref" : "WebServerPort" }]]}
     "Value" : { "Ref" : "Ec2Instance" } 
   }

 }

}
